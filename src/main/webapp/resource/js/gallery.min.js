(function (a) {
	a.fn.DB_gallery = function (b) {
		var c = {
			thumWidth: 110,
			thumGap: 8,
			thumMoveStep: 5,
			moveSpeed: 300,
			fadeSpeed: 300,
			currentImg: 0,
			autoPlay: false,
			autoRollingTime: 3000
		};
		a.extend(c, b);
		return this.each(function () {
			var o = a(this);
			var s = o.find(".imgSet");
			var j = s.find(".imgWin");
			var D = o.find(".info_wrap");
			var t = o.find(".page");
			var F = t.find(".current");
			var u = t.find(".total");
			var H = o.find(".thumSet");
			var x = H.find(".thumMove");
			var B = x.find("li");
			var f = x.find(".info");
			var p = o.find(".thumLine");
			var z = o.find(".nextBtn");
			var n = o.find(".prevBtn");
			var v = o.find(".nextPageBtn");
			var e = o.find(".prevPageBtn");
			var w = B.length;
			var i = c.currentImg;
			var G = i;
			var A = Math.floor(i / c.thumMoveStep);
			var l = Math.ceil(w / c.thumMoveStep);
			var r;
			var q;
			d();
			m();
			k();
			y();
			g();

			function d() {
				x.append(p.get());
				for (var I = 0; I < w; I++) {
					var J = B.eq(I);
					J.css({
						position: "absolute",
						left: (c.thumWidth + c.thumGap) * I
					})
				}
			}

			function m() {
				o.bind("mouseenter", function () {
					clearInterval(q)
				});
				o.bind("mouseleave", function () {
					g()
				});
				B.bind("click", function (I) {
					I.preventDefault();
					i = a(this).index();
					y()
				});
				z.bind("click", function () {
					i++;
					y();
					A = Math.floor(i / c.thumMoveStep);
					k()
				});
				n.bind("click", function () {
					i--;
					y();
					A = Math.floor(i / c.thumMoveStep);
					k()
				});
				v.bind("click", function () {
					A++;
					k()
				});
				e.bind("click", function () {
					A--;
					k()
				})
			}

			function k() {
				var I = ((c.thumWidth + c.thumGap) * c.thumMoveStep) * A;
				x.animate({
					left: -I
				}, c.moveSpeed);
				h()
			}

			function h() {
				e.show();
				v.show();
				n.show();
				z.show();
				if (A == 0) {
					e.hide()
				}
				if (A == l - 1) {
					v.hide()
				}
				if (i == 0) {
					n.hide()
				}
				if (i == w - 1) {
					z.hide()
				}
			}

			function y() {
				if (r != null) {
					j.css("background", "url(" + r + ") no-repeat")
				}
				var I = B.eq(i);
				var J = r = I.find("a").attr("href");
				j.find("img").hide().attr("src", J).fadeIn(c.fadeSpeed);
				r = J;
				p.css({
					left: I.position().left
				});
				F.text(i + 1);
				u.text(w);
				D.html("");
				D.html(f.eq(i).html());
				h()
			}

			function E() {
				if (i == w - 1) {
					i = 0
				} else {
					i++
				}
				y();
				A = Math.floor(i / c.thumMoveStep);
				k()
			}

			function g() {
				if (c.autoPlay) {
					q = setInterval(E, c.autoRollingTime)
				}
			}
		})
	}
})(jQuery);